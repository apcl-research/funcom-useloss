TDAT: public double get rate ( long time ) {  <NL> update ( 0 , time ) ;  <NL> double rate = 0 , total = 0 , weight = 1 ;  <NL> for ( int i = history . length - 1 ; i > = 0 ; i - - ) {  <NL> double interval rate = history [ ( history pos + i ) % history . length ] ;  <NL>  <NL> if ( interval rate = = - 1 ) {  <NL> continue ;  <NL>  }  <NL>  <NL> rate + = interval rate * weight ;  <NL> total + = weight ;  <NL> weight * = history weight ;  <NL>  }  <NL>  <NL> if ( total = = 0 & & rate = = 0 ) {  <NL> return current interval events / ( ( double ) ( time - last interval time + 1 ) ) ;  <NL>  }  <NL>  <NL> return rate / total ;  <NL>  }  COM: <s> if you are specifying a time with update long time then you must </s>