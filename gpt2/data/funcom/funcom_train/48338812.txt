TDAT: private object write replace ( ) throws object stream exception {  <NL> ensure permission ( ) ;  <NL>  <NL>  / / determine id .  <NL> guid id2 = ( guid ) ( ( map ) serialization set . get ( ) ) . get ( id ) ;  <NL>  <NL>  / / sanity check .  <NL> if ( null = = id2 ) {  <NL> throw new illegal state exception ( " attempting to serialize environment " +  <NL>  " outside check - point ( " + this + " ) " ) ;  <NL>  }  <NL>  <NL> return new reference ( id2 ) ;  <NL>  }  COM: <s> replace this environment with an environment reference during </s>