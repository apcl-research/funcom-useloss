TDAT: protected int get max write size ( ) {  <NL> int buf read pos copy = buf read pos , buf write pos copy = buf write pos , buf marked pos copy = buf marked pos ;  <NL> int max write pos ;  <NL>  <NL> if ( buf marked pos copy ! = - 1 )  <NL> max write pos = buf marked pos copy ;  <NL> else <NL> max write pos = buf read pos copy ;  <NL>  <NL> if ( max write pos = = 0 )  <NL> max write pos = buf . length - 1 ;  <NL> else <NL> max write pos - - ;  <NL>  <NL> return get distance ( buf write pos copy , max write pos ) ;  <NL>  }  COM: <s> returns the maximum amount that can be written before blocking </s>