TDAT: protected message wait for message ( long duration ) {  <NL> if ( message = = null ) {  <NL>  <NL> long end time = system . current time millis ( ) + duration ;  <NL> synchronized ( lock ) {  <NL> while ( message = = null & & system . current time millis ( ) < end time ) {  <NL> try {  <NL> lock . wait ( duration ) ;  <NL>  } catch ( interrupted exception e ) {  <NL>  }  <NL>  }  <NL>  }  <NL>  }  <NL> if ( message ! = null ) {  <NL> agent . remove message ( message ) ;  <NL>  }  <NL> return message ;  <NL>  }  COM: <s> wait for message wait for a message to be received by the agent </s>