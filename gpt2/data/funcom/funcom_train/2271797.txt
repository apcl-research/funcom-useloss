TDAT: protected double get visible range ( game map map , point p1 , point p2 , double conspicuousness ) {  <NL> double visibility points left = base visibility ;  <NL> iterator < point > line iterator = new line iterator ( p1 , p2 ) ;  <NL> int visibility counter = 0 ;  <NL> while ( line iterator . has next ( ) & & visibility points left > 0 ) {  <NL> terrain terrain = map . get terrain ( line iterator . next ( ) ) ;  <NL> visibility points left - = ( 1 . 0 / get factor ( terrain ) / conspicuousness ) ;  <NL> if ( visibility points left > = 0 ) {  <NL> visibility counter + + ;  <NL>  }  <NL>  }  <NL> return visibility counter ;  <NL>  }  COM: <s> calculates the visible range on the given line ranging from </s>