TDAT: private void flush ( long now ) throws io exception {  <NL> buf . flip ( ) ;  <NL> interest write channel chan = sink ;  <NL>  <NL> chan . write ( buf ) ;  <NL>  <NL>  / / if we wrote anything , consider this flushed <NL> if ( buf . position ( ) > 0 ) {  <NL> last flush time = now ;  <NL> if ( buf . has remaining ( ) )  <NL> buf . compact ( ) ;  <NL> else <NL> buf . clear ( ) ;  <NL>  } else {  <NL> buf . position ( buf . limit ( ) ) . limit ( buf . capacity ( ) ) ;  <NL>  }  <NL>  }  COM: <s> writes data to the underlying channel remembering the time we did this </s>