TDAT: public void add ( change event event ) {  <NL> if ( event instanceof fyi event ) return ;  <NL>  <NL> if ( undo in progress || redo in progress )  <NL> return ;  <NL> boolean undo empty = undo stack . empty ( ) ;  <NL> boolean redo empty = redo stack . empty ( ) ;  <NL> if ( event . is undoable ( ) ) {  <NL> if ( ! undo empty ) {  <NL> change event prior event = undo stack . peek ( ) ;  <NL> if ( prior event . combine ( event ) )  <NL> return ;  <NL>  }  <NL> undo stack . push ( event ) ;  <NL> if ( ! redo stack . empty ( ) )  <NL> redo stack = new stack < change event > ( ) ;  <NL>  <NL> if ( undo empty || ! redo empty )  <NL> fire history changed ( ) ;  <NL>  }  <NL>  }  COM: <s> add a new undoable event to the undo stack </s>