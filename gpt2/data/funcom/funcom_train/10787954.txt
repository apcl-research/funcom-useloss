TDAT: protected entity manager begin ( ) {  <NL> try {  <NL> lock . lock ( ) ;  <NL> entity manager em = get entity manager ( ) ;  <NL> if ( is managed ) {  <NL> em . join transaction ( ) ;  <NL>  } else {  <NL> if ( ! em . get transaction ( ) . is active ( ) ) {  <NL> em . get transaction ( ) . begin ( ) ;  <NL>  }  <NL>  }  <NL> return em ;  <NL>  } finally {  <NL> lock . unlock ( ) ;  <NL>  }  <NL>  }  COM: <s> begins a transaction on the current thread </s>