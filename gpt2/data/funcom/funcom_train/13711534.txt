TDAT: public void rollback ( ) throws illegal state exception , system exception {  <NL> for ( xa resource res : resource log ) {  <NL> try {  <NL> if ( prepared . contains key ( res ) ) {  <NL>  / / resource reached prepare stage <NL> if ( prepared . get ( res ) . equals ( xa resource . xa _ ok ) )  <NL> res . rollback ( id ) ;  <NL>  } else {  <NL>  / / resource didn ' t reach prepare stage <NL> res . rollback ( id ) ;  <NL>  }  <NL>  } catch ( xa exception e ) {  <NL> logger . severe ( " got xa exception from when rolling back : " + e . get message ( ) ) ;  <NL>  }  <NL>  }  <NL> status = status . status _ rolledback ;  <NL>  }  COM: <s> rollback all prepared xa resources that voted commit </s>