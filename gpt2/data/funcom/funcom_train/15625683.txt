TDAT: public void end transaction ( ) {  <NL> if ( transaction depth < = 0 ) {  <NL> throw new illegal state exception ( " tried to end a transaction but no transaction was open . " ) ;  <NL>  }  <NL> transaction depth - - ;  <NL> assert transaction depth > = 0 ;  <NL> if ( transaction depth = = 0 ) {  <NL> transaction depth = 0 ;  <NL> transaction thread = null ;  <NL> if ( end rec change ( ) ) {  <NL> fire map grid changed event ( ) ;  <NL>  }  <NL>  }  <NL>  }  COM: <s> ends a transaction </s>