TDAT: public boolean set state ( state next state ) {  <NL> if ( next state = = null ) {  <NL> return false ;  <NL>  }  <NL> int next id = next state . get id ( ) ;  <NL> if ( next id > = 0 & & next id < state list . size ( )  <NL>  & & state list . get ( next id ) = = next state ) {  <NL> if ( next state ! = current state ) {  <NL> if ( current state ! = null ) {  <NL> current state . on forced leave ( ) ;  <NL> current state . on leave ( ) ;  <NL>  }  <NL> next state . on enter ( ) ;  <NL> current state = next state ;  <NL> return true ;  <NL>  }  <NL>  }  <NL> return false ;  <NL>  }  COM: <s> this function sets a new state as current state and invokes callbacks </s>