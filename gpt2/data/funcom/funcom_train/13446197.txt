TDAT: protected int calculate break position ( int p0 , int p1 ) {  <NL> int p ;  <NL> segment segment = segment cache . get shared segment ( ) ;  <NL> load text ( segment , p0 , p1 ) ;  <NL> if ( word wrap ) {  <NL> p = p0 + utilities . get break location ( segment , metrics ,  <NL> tab base , tab base + get width ( ) ,  <NL> this , p0 ) ;  <NL>  } else {  <NL> p = p0 + utilities . get tabbed text offset ( segment , metrics ,  <NL> tab base , tab base + get width ( ) ,  <NL> this , p0 ) ;  <NL>  }  <NL> segment cache . release shared segment ( segment ) ;  <NL> return p ;  <NL>  }  COM: <s> this is called by the nested wrapped line </s>