TDAT: private i service factory get factory ( class < ? > resource class , boolean optional ) throws service exception {  <NL> service factory descriptor descriptor = services . get ( resource class . get name ( ) ) ;  <NL> if ( descriptor = = null ) {  <NL> if ( optional )  <NL> return null ;  <NL>  <NL> throw new service exception ( " no factory available for services of kind " + resource class . get name ( ) ) ;  <NL>  }  <NL>  <NL> i service factory factory = null ;  <NL> synchronized ( this ) {  <NL> factory = factories . get ( descriptor ) ;  <NL> if ( factory = = null ) {  <NL> factory = descriptor . get factory instance ( ) ;  <NL> factories . put ( descriptor , factory ) ;  <NL>  }  <NL>  }  <NL>  <NL> return factory ;  <NL>  }  COM: <s> returns the factory which can provide instances of the specified class </s>