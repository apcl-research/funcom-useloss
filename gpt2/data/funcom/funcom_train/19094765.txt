TDAT: public boolean compare and set ( e expect , e update ) {  <NL> state lock . write lock ( ) . lock ( ) ;  <NL> try {  <NL>  / / if the expected doesn ' t match the actual value , don ' t update <NL>  / / note : also do not check waiting threads , no change happened <NL> if ( ! compare states ( state , expect ) || compare states ( state , update ) ) {  <NL> return false ;  <NL>  }  <NL> state = update ;  <NL>  } finally {  <NL> state lock . write lock ( ) . unlock ( ) ;  <NL>  }  <NL>  <NL>  / / note : this code executes only if a state change has occurred <NL> update waiting threads ( update ) ;  <NL> return true ;  <NL>  }  COM: <s> sets a new state value only if the current value matches the expected </s>