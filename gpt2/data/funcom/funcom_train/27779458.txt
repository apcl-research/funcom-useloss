TDAT: private string read message ( buffered reader reader ) throws io exception {  <NL> string buffer buffer = new string buffer ( ) ;  <NL>  <NL> boolean done = false ;  <NL>  <NL> while ( ! done ) {  <NL>  / / read a line and add it to the buffer <NL> string line = read line ( reader ,  <NL> preferences . get int ( " max line length " , 1000 ) ) ;  <NL>  <NL> if ( line . equals ( " . \r\n " )  <NL> || ( buffer . length ( ) > preferences . get int ( " max line length " ,  <NL> 1000 ) ) ) {  <NL>  / / end of buffer <NL> done = true ;  <NL>  } else if ( line . starts with ( " . " ) ) {  <NL> buffer . append ( line . substring ( 1 ) ) ;  <NL>  } else {  <NL> buffer . append ( line ) ;  <NL>  }  <NL>  }  <NL>  <NL> return ( buffer . to string ( ) ) ;  <NL>  }  COM: <s> reads a single message from the given reader halting when the </s>