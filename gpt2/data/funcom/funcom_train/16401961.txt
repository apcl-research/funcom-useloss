TDAT: public void drain ( ) throws io exception {  <NL> try {  <NL> synchronized ( this ) {  <NL> byte [ ] buffer = buffer ( ) ;  <NL> int pos = m pos ;  <NL> int avail = buffer . length - pos - 1 ;  <NL> if ( avail = = 0 ) {  <NL> do write ( buffer , 0 , pos ) ;  <NL> m pos = 0 ;  <NL>  }  <NL>  }  <NL>  } catch ( io exception e ) {  <NL> disconnect ( ) ;  <NL> throw e ;  <NL>  }  <NL>  }  COM: <s> ensures at least one byte can be written blocking if necessary </s>