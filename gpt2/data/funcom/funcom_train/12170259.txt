TDAT: private int get segment index ( shard shard ) {  <NL> if ( ! in any shard ( ) ) {  <NL> throw new illegal state exception (  <NL>  " attempt to calculate text segment index before " +  <NL>  " text annotation added to first shard " ) ;  <NL>  }  <NL>  <NL>  / / the segment array is indexed by the offset of the shard ' s index <NL>  / / from the first shard that this text node is in .  <NL> int shard index = shard . get index ( ) ;  <NL> return shard index - get first shard ( ) ;  <NL>  }  COM: <s> get the text segment index for the specified shard </s>