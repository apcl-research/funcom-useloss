TDAT: public bag value flatten ( ) {  <NL> if ( ! elem type ( ) . is collection ( ) )  <NL> throw new runtime exception ( " bag ` " + type ( )  <NL>  + " ' cannot be flattened " ) ;  <NL>  <NL> collection type c2 = ( collection type ) elem type ( ) ;  <NL> bag value res = new bag value ( c2 . elem type ( ) ) ;  <NL> iterator it = f elements . iterator ( ) ;  <NL> while ( it . has next ( ) ) {  <NL> collection value elem = ( collection value ) it . next ( ) ;  <NL> iterator it2 = elem . iterator ( ) ;  <NL> while ( it2 . has next ( ) ) {  <NL> value elem2 = ( value ) it2 . next ( ) ;  <NL> res . f elements . add ( elem2 ) ;  <NL>  }  <NL>  }  <NL> return res ;  <NL>  }  COM: <s> returns a new flattened bag </s>