TDAT: public matrix get matrix before step ( step child ) {  <NL> matrix matrix ;  <NL> int index ;  <NL>  <NL> index = steps . index of ( child ) ;  <NL> if ( index = = 0 )  <NL> return parent . get matrix before step ( this ) ;  <NL> else {  <NL> if ( ! ( child instanceof atomic step ) )  <NL> return get step before step ( child ) . get after matrix ( ) ;  <NL>  <NL>  / / flat implementation , line above would work as well <NL> matrix = parent . get matrix before step ( this ) ;  <NL> matrix = matrix . clone ( ) ;  <NL>  <NL> for ( step s : steps ) {  <NL>  ( ( atomic step ) s ) . inject change ( matrix ) ;  <NL>  <NL> if ( s = = child )  <NL> break ;  <NL>  }  <NL>  <NL> return matrix ;  <NL>  }  <NL>  }  COM: <s> gets the matrix before the code child code code step code </s>