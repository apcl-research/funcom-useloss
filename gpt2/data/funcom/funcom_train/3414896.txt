TDAT: private node add waiter ( node mode ) {  <NL> node node = new node ( thread . current thread ( ) , mode ) ;  <NL>  / / try the fast path of enq ; backup to full enq on failure <NL> node pred = tail ;  <NL> if ( pred ! = null ) {  <NL> node . prev = pred ;  <NL> if ( compare and set tail ( pred , node ) ) {  <NL> pred . next = node ;  <NL> return node ;  <NL>  }  <NL>  }  <NL> enq ( node ) ;  <NL> return node ;  <NL>  }  COM: <s> creates and enqueues node for current thread and given mode </s>