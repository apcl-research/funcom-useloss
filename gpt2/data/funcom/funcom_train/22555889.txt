TDAT: protected void index document ( final document doc ) throws exception {  <NL>  <NL> final string external id = get key id ( doc ) ;  <NL>  <NL> final index writer writer = get writer ( false ) ;  <NL>  / / final asynchronous index writer awriter = new asynchronous index writer ( writer ) ;  <NL>  <NL> final index searcher searcher = new index searcher ( tenc properties . get instance ( ) . get index dir ( ) ) ;  <NL> final term key term = new term ( tenc _ key _ id , external id ) ;  <NL>  <NL> if ( searcher . doc freq ( key term ) > 0 )  <NL> writer . update document ( key term , doc ) ;  <NL> else <NL> writer . add document ( doc ) ;  <NL>  <NL> writer . optimize ( ) ;  <NL> writer . close ( true ) ;  <NL>  }  COM: <s> add a lucene document to the index </s>