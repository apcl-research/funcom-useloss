TDAT: public int request ( int bytes ) {  <NL> long current time = system . current time millis ( ) ;  <NL> if ( start time = = 0 ) {  <NL> start time = current time ;  <NL> return math . min ( bytes , max rate ) ;  <NL>  } else {  <NL> while ( true ) {  <NL> long max transferred = max rate * ( current time - start time ) / 1000l ;  <NL> if ( transferred < max transferred ) {  <NL> return math . min ( bytes , ( int ) math . max ( max rate , max transferred - transferred ) ) ;  <NL>  } else {  <NL> try {  <NL> thread . sleep ( 100 ) ;  <NL>  }  <NL> catch ( interrupted exception ex ) {  <NL>  / / do nothing <NL>  }  <NL> current time = system . current time millis ( ) ;  <NL>  }  <NL>  }  <NL>  }  <NL>  }  COM: <s> request transfer of a given number of bytes </s>