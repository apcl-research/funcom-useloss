TDAT: private int do cancel ( ) {  <NL> int deselected = 0 ;  <NL>  <NL> set < selection key > cancelled keys = cancelled keys ( ) ;  <NL> synchronized ( cancelled keys ) {  <NL> if ( cancelled keys . size ( ) > 0 ) {  <NL> for ( selection key currentkey : cancelled keys ) {  <NL> mutable keys . remove ( currentkey ) ;  <NL> deregister ( ( abstract selection key ) currentkey ) ;  <NL> if ( mutable selected keys . remove ( currentkey ) ) {  <NL> deselected + + ;  <NL>  }  <NL>  }  <NL> cancelled keys . clear ( ) ;  <NL>  }  <NL>  }  <NL>  <NL> return deselected ;  <NL>  }  COM: <s> removes cancelled keys from the key set and selected key set and </s>