TDAT: protected void reset current vat ( ) {  <NL> vat vat = current vat . get ( ) ;  <NL> if ( vat = = null ) {  <NL> throw new illegal state exception (  <NL>  " no vat is installed inthis thread . " ) ;  <NL>  <NL>  }  <NL> if ( vat ! = this ) {  <NL> throw new illegal state exception (  <NL>  " other vat is installed in this thread : " + vat ) ;  <NL>  <NL>  }  <NL> synchronized ( state lock ) {  <NL> if ( queue . is empty ( ) ) {  <NL> state = vat state . idle ;  <NL>  } else if ( runner ! = null ) {  <NL> enqueue vat ( ) ;  <NL>  } else {  <NL>  / / this is the case when vat was detached <NL>  / / during its turn <NL> state = vat state . pending ;  <NL>  }  <NL>  }  <NL> current vat . remove ( ) ;  <NL>  }  COM: <s> disassociate thread from vat </s>