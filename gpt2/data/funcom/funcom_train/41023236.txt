TDAT: public void cast spell ( spell ability sa ) {  <NL> get stack ( ) . add ( sa ) ;  <NL> while ( sa . has aspect ( magic wars model . aspect _ has _ attached _ spells ) ) {  <NL> spell ability attached spell = ( spell ability ) sa . get spell chain ( ) . get param ( ) ;  <NL> game . get stack ( ) . add ( attached spell ) ;  <NL> sa = attached spell ;  <NL>  }  <NL> sa . get source card ( ) . when play command ( ) ;  <NL>  }  COM: <s> while casting a spell extracts all attached spells and calls when play command </s>