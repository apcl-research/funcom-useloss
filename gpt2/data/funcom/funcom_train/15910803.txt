TDAT: public void run ( ) {  <NL> if ( with analysis ) {  <NL> run with analysis ( ) ;  <NL> return ;  <NL>  }  <NL>  <NL> run = true ;  <NL> long i = 0 ;  <NL>  <NL> if ( machine . get frequency ( ) = = 0 ) {  <NL>  / / run at maximum rate <NL> while ( run ) {  <NL> machine . run one tick ( ) ;  <NL> i + + ;  <NL>  }  <NL>  }  <NL> else {  <NL>  / / run at a given rate <NL> int sleep ;  <NL> int period = ( int ) ( 1 . 0 / machine . get frequency ( ) * 1000 . 0 ) ;  <NL> while ( run ) {  <NL> timer . reset ( ) ;  <NL> machine . run one tick ( ) ;  <NL> i + + ;  <NL> sleep = period - timer . get int time ( ) ;  <NL> if ( sleep > 0 )  <NL> try {  <NL> thread . sleep ( sleep ) ;  <NL>  }  <NL> catch ( interrupted exception e ) {  <NL> break ;  <NL>  }  <NL>  }  <NL>  }  <NL>  }  COM: <s> machines main loop </s>