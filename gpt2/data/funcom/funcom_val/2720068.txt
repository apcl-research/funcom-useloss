TDAT: protected void process greeting ( response r ) throws protocol exception {  <NL> super . process greeting ( r ) ; / / check if it ' s bad <NL> if ( r . is ok ( ) ) { / / check if it ' s ok <NL> set capabilities ( r ) ;  <NL> return ;  <NL>  }  <NL>  / / only other choice is preauth <NL> imap response ir = ( imap response ) r ;  <NL> if ( ir . key equals ( " preauth " ) ) {  <NL> authenticated = true ;  <NL> set capabilities ( r ) ;  <NL>  } else <NL> throw new connection exception ( this , r ) ;  <NL>  }  COM: <s> check the greeting when first connecting look for preauth response </s>